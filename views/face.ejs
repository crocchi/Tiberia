<!-- filepath: /Users/costantinoruggiero/Documents/GitHub/Tiberia/views/face.ejs -->
<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Animazione Spongebob - Mezzo Busto</title>
    <style>
      html, body, canvas { height: 100%; margin: 0; padding: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
     // Inizializza scena, camera, renderer
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Luce ambientale
const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambientLight);

// Carica il modello GLB
const loader = new THREE.GLTFLoader();
let model, leftEye, rightEye;
loader.load('/models/spongebob.glb', function (gltf) {
  model = gltf.scene;
  scene.add(model);

  // Trova i mesh degli occhi (modifica i nomi se diversi)
  leftEye = model.getObjectByName('Left_Eye');
  rightEye = model.getObjectByName('Right_Eye');

  // Posizione e scala per mezzo busto (centra e ridimensiona)
  model.position.set(0, -2, 2);
  model.scale.set(1.5, 1.5, 1.5);
}, undefined, function (error) {
  console.error(error);
});

// Controlli per mobile (ruota, zoom, sposta con dito)
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enablePan = true;
controls.enableZoom = true;
controls.enableRotate = true;

// Animazione occhi (apri/chiudi naturale con sinusoide)
let time = 0;
function animate() {
  requestAnimationFrame(animate);
  time += 0.01; // VelocitÃ  animazione

  // Occhi: scala Y oscillante tra 0.1 (chiuso) e 1 (aperto), naturale
  if (leftEye && rightEye) {
    const eyeScale = 0.55 + 0.45 * Math.sin(time * 2); // Ciclo lento, naturale
    leftEye.scale.y = eyeScale;
    rightEye.scale.y = eyeScale;
  }

  controls.update();
  renderer.render(scene, camera);
}
animate();

// Ridimensiona canvas su resize finestra
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
    </script>
  </body>
</html>